---
title: "p8105_hw5_ks3663"
author: "Kee-Young Shin"
date: "November 3, 2018"
output: html_document
---

```{r}
library(tidyverse)
library(purrr)
library(RCurl)

```

## Problem 1
```{r}

files_list = paste0("./data/", list.files("./data"))
files_list

output = map_df(files_list, read.csv) %>% 
  add_column(files_list, .before = "week_1") %>% 
  mutate(files_list = str_replace(files_list, "./data/", ""),
         files_list = str_replace(files_list, ".csv", "")) %>% 
  separate(files_list, into = c("Control Arm", "Subject ID"), sep = "_") %>% 
  janitor::clean_names()
output

```

```{r}
# make spaghetti plot comparing both arms 
output %>% 
  gather(key = week, value = observation, week_1:week_8) %>% 
  arrange(control_arm, subject_id) %>% 
  group_by(subject_id) %>% 
  ggplot(aes(x = week, y = observation, color = subject_id, group = subject_id)) + 
    geom_line() + 
    facet_wrap(~control_arm) + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

## Problem 2
```{r}
homicide_df = read.csv(text = getURL("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")) %>% 
  unite(city_state, city:state, sep = ", ") %>% 
  janitor::clean_names()

homicide_df_summarized = homicide_df %>% 
  group_by(city_state) %>% 
  summarize(total_homicide = n(),
      unsolved_homicide = sum(disposition == "Closed without arrest") 
      + sum(disposition == "Open/No arrest"))

homicide_df_summarized

```

```{r}
# run prop.test for Baltimore, MD
prop.test(x = homicide_df_summarized %>% filter(city_state == "Baltimore, MD") %>% pull(unsolved_homicide), n = homicide_df_summarized %>% filter(city_state == "Baltimore, MD") %>%  pull(total_homicide))

dfr <- data.frame(k=c(60,50,70,40),n=rep(500,4))
Map(prop.test,x=dfr$k,n=dfr$n)

prop_test_fuc = function(v) {
  
  t = prop.test(x = v %>% pull(unsolved_homicide), n = v %>% pull(total_homicide))
  t
  
}

homicide_df_summarized %>% 
  filter(city_state == "Baltimore, MD") %>% 
  prop_test_fuc()

map2(.x = homicide_df_summarized %>% pull(unsolved_homicide), .y = homicide_df_summarized %>% pull(total_homicide), ~prop.test(x = .x, n = .y))

```

